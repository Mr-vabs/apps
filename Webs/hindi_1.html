<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP Police Hindi Typing (Final) - Structured & Sensible</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;600;700&family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-hindi { font-family: 'Noto Sans Devanagari', sans-serif; }
        .font-mono-key { font-family: 'JetBrains Mono', monospace; }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        
        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #0f172a; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 h-screen overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- ICONS ---
        const Icons = {
            Play: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Pause: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>,
            Timer: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Menu: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>,
            X: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Refresh: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Check: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
            Lock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            Skull: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></svg>,
            Keyboard: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="M6 8h.001"/><path d="M10 8h.001"/><path d="M14 8h.001"/><path d="M18 8h.001"/><path d="M6 12h.001"/><path d="M10 12h.001"/><path d="M14 12h.001"/><path d="M18 12h.001"/><path d="M7 16h10"/></svg>
        };

        // --- TRUE INSCRIPT MAPPING ---
        const INSCRIPT = {
            '`': '़', '1': '१', '2': '२', '3': '३', '4': '४', '5': '५', '6': '६', '7': '७', '8': '८', '9': '९', '0': '०', '-': '.', '=': 'ृ',
            'q': 'ौ', 'w': 'ै', 'e': 'ा', 'r': 'ी', 't': 'ू', 'y': 'ब', 'u': 'ह', 'i': 'ग', 'o': 'द', 'p': 'ज', '[': 'ड', ']': '़', '\\': 'ॉ',
            'a': 'ो', 's': 'े', 'd': '्', 'f': 'ि', 'g': 'ु', 'h': 'प', 'j': 'र', 'k': 'क', 'l': 'त', ';': 'च', "'": 'ट',
            'z': '्र', 'x': 'ं', 'c': 'म', 'v': 'न', 'b': 'व', 'n': 'ल', 'm': 'स', ',': ',', '.': '.', '/': 'य',
            'Q': 'औ', 'W': 'ऐ', 'E': 'आ', 'R': 'ई', 'T': 'ऊ', 'Y': 'भ', 'U': 'ङ', 'I': 'घ', 'O': 'ध', 'P': 'झ', '{': 'ढ', '}': 'ञ', '|': 'ऑ',
            'A': 'ओ', 'S': 'ए', 'D': 'अ', 'F': 'इ', 'G': 'उ', 'H': 'फ', 'J': 'र्', 'K': 'ख', 'L': 'थ', ':': 'छ', '"': 'ठ',
            'Z': 'र्', 'X': 'ँ', 'C': 'ण', 'V': 'ऩ', 'B': 'ळ', 'N': 'ल्र', 'M': 'श', '<': 'ष', '>': '।', '?': '?'
        };

        const FINGER_MAP = {
            // Left Hand
            '`': 'Left Pinky', '1': 'Left Pinky', 'q': 'Left Pinky', 'a': 'Left Pinky', 'z': 'Left Pinky',
            '2': 'Left Ring', 'w': 'Left Ring', 's': 'Left Ring', 'x': 'Left Ring',
            '3': 'Left Middle', 'e': 'Left Middle', 'd': 'Left Middle', 'c': 'Left Middle',
            '4': 'Left Index', 'r': 'Left Index', 'f': 'Left Index', 'v': 'Left Index',
            '5': 'Left Index', 't': 'Left Index', 'g': 'Left Index', 'b': 'Left Index',
            
            // Right Hand
            '6': 'Right Index', 'y': 'Right Index', 'h': 'Right Index', 'n': 'Right Index',
            '7': 'Right Index', 'u': 'Right Index', 'j': 'Right Index', 'm': 'Right Index',
            '8': 'Right Middle', 'i': 'Right Middle', 'k': 'Right Middle', ',': 'Right Middle',
            '9': 'Right Ring', 'o': 'Right Ring', 'l': 'Right Ring', '.': 'Right Ring',
            '0': 'Right Pinky', 'p': 'Right Pinky', ';': 'Right Pinky', '/': 'Right Pinky',
            '-': 'Right Pinky', '[': 'Right Pinky', '\'': 'Right Pinky',
            '=': 'Right Pinky', ']': 'Right Pinky',
            
            'Space': 'Thumb'
        };

        const keysToHindi = (keyStr) => keyStr.split('').map(k => INSCRIPT[k] || k).join('');

        const createDrill = (id, keysInput, hint, repeat = 1, duration = 0) => {
            let content = "";
            if (keysInput.includes(' ')) {
                // If input has spaces (e.g., "word1 word2"), map each block independently
                content = keysInput.split(' ').map(wordKeys => keysToHindi(wordKeys)).join(' ');
            } else {
                content = keysToHindi(keysInput);
            }
            
            // Generate full string
            const finalContent = Array(repeat).fill(content).join(' ');

            return {
                id,
                type: 'word',
                content: finalContent,
                hint: `${hint}`,
                raw: keysInput,
                duration: duration // in seconds
            };
        };

        // --- CURRICULUM (FIXED & SENSIBLE) ---
        const CURRICULUM = {
            1: {
                title: "Day 1: Home Row (क प त च र)",
                exercises: [
                    // --- PART 1: BLOCK REPETITION (Soni Style) ---
                    // Right: k=ka, h=pa, j=ra, l=ta, ;=cha
                    createDrill('d1_1', 'kkkk', 'Drill: कककक', 5),
                    createDrill('d1_2', 'hhhh', 'Drill: पपपप', 5),
                    createDrill('d1_3', 'jjjj', 'Drill: रररर', 5),
                    createDrill('d1_4', 'llll', 'Drill: तततत', 5),
                    createDrill('d1_5', ';;;;', 'Drill: चचचच', 5),
                    // Left: e=aa, f=i, s=e, g=u
                    createDrill('d1_6', 'eeee', 'Drill: ाााा', 5),
                    createDrill('d1_7', 'ffff', 'Drill: िििि', 5),
                    createDrill('d1_8', 'ssss', 'Drill: ेेेे', 5),
                    createDrill('d1_9', 'gggg', 'Drill: ुुुु', 5),

                    // --- PART 2: SIMPLE PATTERNS ---
                    createDrill('d1_10', 'khkh', 'Pattern: क पक प', 10),
                    createDrill('d1_11', 'ljlj', 'Pattern: त रत र', 10),
                    createDrill('d1_12', 'efef', 'Pattern: ा िा ि', 10),
                    createDrill('d1_13', 'asdf hjkl', 'Row Flow', 10),

                    // --- PART 3: MATRA COMBINATIONS ---
                    // ka, pa, ra, ta, cha
                    createDrill('d1_14', 'ke he je le ;e', 'Aa Matra: का पा रा ता चा', 10),
                    createDrill('d1_15', 'kf hf jf lf ;f', 'i Matra: कि पि रि ति चि', 10),
                    createDrill('d1_16', 'ks hs js ls ;s', 'e Matra: के पे रे ते चे', 10),
                    createDrill('d1_17', 'kg hg jg lg ;g', 'u Matra: कु पु रु तु चु', 10),

                    // --- PART 4: SENSIBLE WORDS (Using ONLY Home keys + e) ---
                    // Available: k, h, j, l, ;, e (aa)
                    createDrill('d1_18', 'kj hj lj ;j', '2-Char: कर पर तर चर', 15),
                    createDrill('d1_19', 'lk hk', '2-Char: तक पक', 15),
                    createDrill('d1_20', 'hke hle ;ke', 'Matra Words: पा ता चा', 15),
                    createDrill('d1_21', 'kaka papa tata chacha', 'Relations: काका पापा ताता चाचा', 10),
                    createDrill('d1_22', 'pata chara', 'Words: पता (Address) चारा (Fodder)', 10),
                    
                    // --- PART 5: SENTENCE ---
                    createDrill('d1_final', 'kaka pata kar', 'Sentence: काका पता कर', 15)
                ]
            },
            2: {
                title: "Day 2: Top Row (ब ह ग द ज)",
                exercises: [
                    // --- BLOCK REPETITION ---
                    createDrill('d2_1', 'uuuu', 'Drill: हहहह (ha)', 5),
                    createDrill('d2_2', 'iiii', 'Drill: गगगग (ga)', 5),
                    createDrill('d2_3', 'oooo', 'Drill: दददद (da)', 5),
                    createDrill('d2_4', 'pppp', 'Drill: जजजज (ja)', 5),
                    createDrill('d2_5', 'yyyy', 'Drill: बबबब (ba)', 5),
                    
                    // --- MATRA BLOCKS ---
                    createDrill('d2_6', 'rrrr', 'Drill: ीीीी (ee)', 5),
                    createDrill('d2_7', 'tttt', 'Drill: ूूूू (oo)', 5),
                    createDrill('d2_8', 'wwww', 'Drill: ैैैै (ai)', 5),
                    createDrill('d2_9', 'qqqq', 'Drill: ौौौौ (au)', 5),

                    // --- VERTICAL TRANSITIONS ---
                    createDrill('d2_10', 'hu ki lo ;p', 'Home->Top Jumps', 15),

                    // --- WORDS (Home + Top) ---
                    createDrill('d2_11', 'pj oj yj', 'Words: जर दर बर', 15),
                    createDrill('d2_12', 'ij uj', 'Words: गर हर', 15),
                    createDrill('d2_13', 'uw', 'Word: है (is)', 20),
                    createDrill('d2_14', 'ke ki ku', 'Review: का कि कु', 10),
                    createDrill('d2_15', 'kr kt kw kq', 'New Matras: की कू कै कौ', 10),
                    
                    // --- SENTENCES ---
                    createDrill('d2_16', 'uw ij ke pj uw', 'Sentence: है गर का जर है', 10), // Nonsense but good muscle practice
                    createDrill('d2_17', 'hai pani pi', 'Sentence: है पानी पी (using keys)', 10)
                ]
            },
            3: {
                title: "Day 3: Lower Row (म न व ल स)",
                exercises: [
                    // --- BLOCK REPETITION ---
                    createDrill('d3_1', 'cccc vvvv bbbb nnnn mmmm', 'Bottom Row Blocks', 3),
                    createDrill('d3_2', 'xxxx', 'Drill: ंंंं (Dot)', 5),

                    // --- WORDS (All Rows) ---
                    // Now 'n' (la) is available. 'jal' works.
                    createDrill('d3_3', 'pn on yn', 'Words: जल दल बल', 15),
                    createDrill('d3_4', 'samay', 'Word: समय', 15),
                    createDrill('d3_5', 'naman', 'Word: नमन', 15),
                    createDrill('d3_6', 'kamal', 'Word: कमल', 15),
                    createDrill('d3_7', 'sarkar', 'Word: सरकार', 15),
                    
                    // --- TIMED TEST (3 Minutes) ---
                    // Valid words using all 3 rows
                    // "samay naman kamal sarkar jal dal bal hai ka ki ke"
                    createDrill('d3_timed', 'samay naman kamal sarkar jal dal bal hai ka ki ke samay naman kamal sarkar jal dal bal hai ka ki ke', '3 Min Speed Check', 5, 180)
                ]
            },
            4: {
                title: "Day 4: Integration (Mixed Practice)",
                exercises: [
                    createDrill('d4_1', 'ki ku ke ko', 'Matra Refresh', 15),
                    createDrill('d4_2', 'paani rani', 'Words: पानी रानी', 15),
                    createDrill('d4_3', 'khelna kudna', 'Words: खेलना कूदना', 15),
                    createDrill('d4_4', 'chalna rukna', 'Words: चलना रुकना', 15),
                    createDrill('d4_5', 'aaj kal parso', 'Time: आज कल परसों', 15),
                    
                    // 3 Min Test (Mixed Words)
                    createDrill('d4_timed', 'paani rani khelna kudna chalna rukna aaj kal parso hamesha koshish safalta', '3 Min Vocab Test', 5, 180)
                ]
            },
            5: {
                title: "Day 5: Common Vocabulary",
                exercises: [
                    createDrill('d5_1', 'man tan dhan', 'Rhyming: मन तन धन', 15),
                    createDrill('d5_2', 'kab jab tab', 'Rhyming: कब जब तब', 15),
                    createDrill('d5_3', 'naram garam', 'Rhyming: नरम गरम', 15),
                    createDrill('d5_4', 'saman daman', 'Rhyming: समन दमन', 15),
                    
                    // 5 Min Test
                    createDrill('d5_timed', 'man tan dhan kab jab tab naram garam saman daman samay samaj namak chamak saral taral kalam balam jan gan man', '5 Min Rhyme Test', 5, 300)
                ]
            },
            6: {
                title: "Day 6: Official Vocabulary",
                exercises: [
                    createDrill('d6_1', 'ke hai mein ki', 'Connectors 1', 15),
                    createDrill('d6_2', 'aur se ko ka', 'Connectors 2', 15),
                    createDrill('d6_3', 'police thana report', 'Police Vocab', 10),
                    createDrill('d6_4', 'nyayalaya samvidhan', 'Legal Vocab', 10),
                    createDrill('d6_5', 'adhikar kartavya', 'Civics Vocab', 10),
                    
                    // 10 Min Test
                    createDrill('d6_timed', 'police thana report nyayalaya samvidhan adhikar kartavya prarthna patra mahoday savinay bhavdiya hastakshar dinank aavedan suchna karyalaya', '10 Min Official Test', 8, 600)
                ]
            },
            7: {
                title: "Day 7: Full Mock Tests",
                exercises: [
                    // Mock 1 (15 Mins) - approx 400 words of content
                    { 
                        id: 'd7_1', 
                        type: 'paragraph', 
                        content: 'शिक्षा मनुष्य के जीवन का आधार है। यह हमें सही और गलत में भेद करना सिखाती है। बिना शिक्षा के मनुष्य पशु समान है। शिक्षा से ही समाज में उन्नति होती है। एक शिक्षित व्यक्ति देश का जिम्मेदार नागरिक बनता है। हमें न केवल किताबी ज्ञान बल्कि व्यावहारिक ज्ञान भी अर्जित करना चाहिए। अनुशासन सफलता की पहली सीढ़ी है। विद्यार्थी जीवन में अनुशासन का विशेष महत्व है। जो समय का सदुपयोग करते हैं वे ही सफल होते हैं।', 
                        repeat: 3, 
                        hint: 'Mock 1: General (15 Min)', 
                        duration: 900, 
                        raw: '' 
                    },
                    // Mock 2 (15 Mins) - Legal/Formal
                    { 
                        id: 'd7_2', 
                        type: 'paragraph', 
                        content: 'संविधान के अनुच्छेद ३४३ के अनुसार संघ की राजभाषा हिंदी और लिपि देवनागरी है। शासकीय कार्यों में हिंदी का प्रयोग अनिवार्य है। सभी सरकारी कार्यालयों में हिंदी पखवाड़ा मनाया जाता है। हमें अपनी राजभाषा पर गर्व होना चाहिए और इसका अधिक से अधिक प्रयोग करना चाहिए। न्यायालय में भी हिंदी का प्रयोग बढ़ रहा है। इससे आम जनता को न्याय प्रक्रिया समझने में आसानी होती है।', 
                        repeat: 3, 
                        hint: 'Mock 2: Legal (15 Min)', 
                        duration: 900, 
                        raw: '' 
                    },
                    // Mock 3 (15 Mins) - Police Specific
                    { 
                        id: 'd7_3', 
                        type: 'paragraph', 
                        content: 'उत्तर प्रदेश पुलिस का ध्येय वाक्य सुरक्षा आपकी संकल्प हमारा है। पुलिस बल समाज में कानून व्यवस्था बनाए रखने के लिए प्रतिबद्ध है। पुलिस कर्मियों को कठिन परिस्थितियों में कार्य करना पड़ता है। हमें पुलिस का सहयोग करना चाहिए ताकि अपराध मुक्त समाज का निर्माण हो सके। पुलिस थाने में रिपोर्ट दर्ज कराने की प्रक्रिया सरल है। साइबर अपराध से बचने के लिए सतर्क रहें।', 
                        repeat: 3, 
                        hint: 'Mock 3: Police (15 Min)', 
                        duration: 900, 
                        raw: '' 
                    }
                ]
            }
        };

        const KEYBOARD_LAYOUT = [
            [
                { code: 'Backquote', key: '`', h1: '़', h2: 'ञ', w: 'w-10' },
                { code: 'Digit1', key: '1', h1: '१', h2: 'ज्ञ', w: 'w-10' },
                { code: 'Digit2', key: '2', h1: '२', h2: 'श्र', w: 'w-10' },
                { code: 'Digit3', key: '3', h1: '३', h2: 'रू', w: 'w-10' },
                { code: 'Digit4', key: '4', h1: '४', h2: 'ः', w: 'w-10' },
                { code: 'Digit5', key: '5', h1: '५', h2: 'श्र', w: 'w-10' },
                { code: 'Digit6', key: '6', h1: '६', h2: 'त्र', w: 'w-10' },
                { code: 'Digit7', key: '7', h1: '७', h2: 'क्ष', w: 'w-10' },
                { code: 'Digit8', key: '8', h1: '८', h2: 'श', w: 'w-10' },
                { code: 'Digit9', key: '9', h1: '९', h2: '(', w: 'w-10' },
                { code: 'Digit0', key: '0', h1: '०', h2: ')', w: 'w-10' },
                { code: 'Minus', key: '-', h1: '.', h2: 'ऋ', w: 'w-10' },
                { code: 'Equal', key: '=', h1: 'ृ', h2: 'र्', w: 'w-10' },
                { code: 'Backspace', key: '⌫', h1: '', h2: '', w: 'w-auto flex-1' }
            ],
            [
                { code: 'Tab', key: 'Tab', h1: '', h2: '', w: 'w-14' },
                { code: 'KeyQ', key: 'q', h1: 'ौ', h2: 'औ', w: 'w-10' },
                { code: 'KeyW', key: 'w', h1: 'ै', h2: 'ऐ', w: 'w-10' },
                { code: 'KeyE', key: 'e', h1: 'ा', h2: 'आ', w: 'w-10' },
                { code: 'KeyR', key: 'r', h1: 'ी', h2: 'ई', w: 'w-10' },
                { code: 'KeyT', key: 't', h1: 'ू', h2: 'ऊ', w: 'w-10' },
                { code: 'KeyY', key: 'y', h1: 'ब', h2: 'भ', w: 'w-10' },
                { code: 'KeyU', key: 'u', h1: 'ह', h2: 'ङ', w: 'w-10' },
                { code: 'KeyI', key: 'i', h1: 'ग', h2: 'घ', w: 'w-10' },
                { code: 'KeyO', key: 'o', h1: 'द', h2: 'ध', w: 'w-10' },
                { code: 'KeyP', key: 'p', h1: 'ज', h2: 'झ', w: 'w-10' },
                { code: 'BracketLeft', key: '[', h1: 'ड', h2: 'ढ', w: 'w-10' },
                { code: 'BracketRight', key: ']', h1: '़', h2: 'ञ', w: 'w-10' },
                { code: 'Backslash', key: '\\', h1: 'ॉ', h2: 'ऑ', w: 'w-10' }
            ],
            [
                { code: 'CapsLock', key: 'Caps', h1: '', h2: '', w: 'w-16' },
                { code: 'KeyA', key: 'a', h1: 'ो', h2: 'ओ', w: 'w-10' },
                { code: 'KeyS', key: 's', h1: 'े', h2: 'ए', w: 'w-10' },
                { code: 'KeyD', key: 'd', h1: '्', h2: 'अ', w: 'w-10' },
                { code: 'KeyF', key: 'f', h1: 'ि', h2: 'इ', w: 'w-10' },
                { code: 'KeyG', key: 'g', h1: 'ु', h2: 'उ', w: 'w-10' },
                { code: 'KeyH', key: 'h', h1: 'प', h2: 'फ', w: 'w-10' },
                { code: 'KeyJ', key: 'j', h1: 'र', h2: 'र्', w: 'w-10' },
                { code: 'KeyK', key: 'k', h1: 'क', h2: 'ख', w: 'w-10' },
                { code: 'KeyL', key: 'l', h1: 'त', h2: 'थ', w: 'w-10' },
                { code: 'Semicolon', key: ';', h1: 'च', h2: 'छ', w: 'w-10' },
                { code: 'Quote', key: "'", h1: 'ट', h2: 'ठ', w: 'w-10' },
                { code: 'Enter', key: 'Enter', h1: '↵', h2: '', w: 'w-auto flex-1' }
            ],
            [
                { code: 'ShiftLeft', key: 'Shift', h1: '', h2: '', w: 'w-20' },
                { code: 'KeyZ', key: 'z', h1: '्र', h2: 'र्', w: 'w-10' },
                { code: 'KeyX', key: 'x', h1: 'ं', h2: 'ँ', w: 'w-10' },
                { code: 'KeyC', key: 'c', h1: 'म', h2: 'ण', w: 'w-10' },
                { code: 'KeyV', key: 'v', h1: 'न', h2: 'ऩ', w: 'w-10' },
                { code: 'KeyB', key: 'b', h1: 'व', h2: 'ळ', w: 'w-10' },
                { code: 'KeyN', key: 'n', h1: 'ल', h2: 'ल्र', w: 'w-10' },
                { code: 'KeyM', key: 'm', h1: 'स', h2: 'श', w: 'w-10' },
                { code: 'Comma', key: ',', h1: ',', h2: 'ष', w: 'w-10' },
                { code: 'Period', key: '.', h1: '.', h2: '।', w: 'w-10' },
                { code: 'Slash', key: '/', h1: 'य', h2: '?', w: 'w-10' },
                { code: 'ShiftRight', key: 'Shift', h1: '', h2: '', w: 'w-auto flex-1' }
            ],
            [
                { code: 'Space', key: 'Space', h1: '', h2: '', w: 'w-64 mx-auto' }
            ]
        ];

        // --- COMPONENTS ---
        const VirtualKeyboard = ({ nextChar, pressedKeys }) => {
            const targetKey = useMemo(() => {
                if (!nextChar) return { code: null, shift: false };
                if (nextChar === ' ') return { code: 'Space', shift: false };
                
                for (const row of KEYBOARD_LAYOUT) {
                    for (const k of row) {
                        if (k.h1 === nextChar || k.key === nextChar) return { code: k.code, shift: false };
                        if (k.h2 === nextChar) return { code: k.code, shift: true };
                    }
                }
                return { code: null, shift: false };
            }, [nextChar]);

            return (
                <div className="flex flex-col gap-2 select-none w-full scale-100 origin-center max-w-4xl mx-auto">
                    {KEYBOARD_LAYOUT.map((row, rIdx) => (
                        <div key={rIdx} className="flex justify-center gap-2">
                            {row.map((k) => {
                                const isTarget = targetKey.code === k.code;
                                const isShiftNeeded = targetKey.shift && (k.key === 'Shift');
                                const isPressed = pressedKeys.has(k.code);
                                
                                let bg = "bg-slate-800 border-slate-900 border-b-4 text-slate-500";
                                let translate = "";
                                let glow = "";

                                if (isTarget || isShiftNeeded) {
                                    bg = "bg-yellow-500 border-yellow-700 border-b-4 text-black ring-4 ring-yellow-500/30";
                                    glow = "animate-pulse";
                                }
                                if (isPressed) {
                                    bg = "bg-blue-500 border-blue-700 border-b-0 mt-1 text-white";
                                }

                                return (
                                    <div key={k.code} className={`${k.w} h-14 md:h-16 rounded-lg flex flex-col items-center justify-center transition-all duration-75 relative ${bg} ${translate} ${glow}`}>
                                        
                                        {/* ENGLISH KEY (THE VISUAL ANCHOR) */}
                                        <div className={`font-mono-key text-lg md:text-2xl font-bold ${isTarget || isShiftNeeded ? 'text-black' : 'text-slate-200'}`}>
                                            {k.key === 'Space' ? 'Space' : (k.key.length === 1 ? k.key.toUpperCase() : k.key)}
                                        </div>

                                        {/* HINDI KEY (THE OUTPUT) */}
                                        {k.key.length === 1 && (
                                            <div className="absolute bottom-1 right-1.5 flex gap-1 opacity-70">
                                                <span className="text-[10px] md:text-xs font-hindi">{k.h1}</span>
                                            </div>
                                        )}
                                        {k.key.length === 1 && (
                                            <div className="absolute top-1 left-1.5 flex gap-1 opacity-50">
                                                <span className="text-[10px] md:text-xs font-hindi">{k.h2}</span>
                                            </div>
                                        )}
                                    </div>
                                )
                            })}
                        </div>
                    ))}
                </div>
            );
        };

        const Timer = ({ status, time, mode = 'up' }) => {
            const formatTime = (seconds) => {
                const m = Math.floor(seconds / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toString().padStart(2, '0');
                return `${m}:${s}`;
            };
            
            // Visual logic: Green if plenty time, Red if low time (for countdown)
            let colorClass = "bg-green-500/10 text-green-400 border-green-500/30";
            if (mode === 'down' && time < 60) colorClass = "bg-red-500/10 text-red-400 border-red-500/30 animate-pulse";

            return (
                <div className={`flex items-center gap-2 px-4 py-2 rounded-lg font-mono text-lg font-bold border transition-colors ${status === 'running' ? colorClass : 'bg-slate-800 text-slate-400 border-transparent'}`}>
                    <Icons.Timer />
                    {formatTime(time)}
                </div>
            );
        };

        const App = () => {
            const [day, setDay] = useState(1);
            const [drillIndex, setDrillIndex] = useState(0);
            const [inputText, setInputText] = useState("");
            const [timerStatus, setTimerStatus] = useState('idle');
            const [elapsedTime, setElapsedTime] = useState(0);
            const [stats, setStats] = useState({ wpm: 0, accuracy: 100, errors: 0, total: 0 });
            const [pressedKeys, setPressedKeys] = useState(new Set());
            const [isCompleted, setIsCompleted] = useState(false);
            const [isSidebarOpen, setSidebarOpen] = useState(false);
            
            // Settings
            const [disableBackspace, setDisableBackspace] = useState(false);
            const [strictMode, setStrictMode] = useState(false); 
            const [isShaking, setIsShaking] = useState(false); 

            const inputRef = useRef(null);

            const currentDrill = CURRICULUM[day].exercises[drillIndex];
            const totalDrills = CURRICULUM[day].exercises.length;
            const progressPercent = ((drillIndex) / totalDrills) * 100;
            const targetText = useMemo(() => currentDrill.content, [currentDrill]);
            const nextChar = targetText[inputText.length] || null;
            
            // Finger Guide Logic
            const nextKeyEnglish = useMemo(() => {
                if (!nextChar) return null;
                if (nextChar === ' ') return 'Space';
                // Reverse lookup in INSCRIPT map to find english key for hindi char
                return Object.keys(INSCRIPT).find(key => INSCRIPT[key] === nextChar) || null;
            }, [nextChar]);
            
            const fingerHint = nextKeyEnglish ? (FINGER_MAP[nextKeyEnglish.toLowerCase()] || 'Thumb') : 'Done';

            // Reset logic when drill changes
            useEffect(() => { 
                resetDrill(); 
                // Set initial time based on drill duration
                if (currentDrill.duration) {
                    setElapsedTime(currentDrill.duration);
                } else {
                    setElapsedTime(0);
                }
            }, [day, drillIndex]);
            
            useEffect(() => { 
                if (inputRef.current && timerStatus !== 'paused' && !isCompleted && !isSidebarOpen) {
                    inputRef.current.focus(); 
                }
            }, [inputText, isCompleted, isSidebarOpen, timerStatus]);

            useEffect(() => {
                let interval;
                if (timerStatus === 'running') {
                    interval = setInterval(() => {
                        // Countdown vs Countup
                        if (currentDrill.duration) {
                            setElapsedTime(prev => {
                                if (prev <= 1) {
                                    setTimerStatus('finished');
                                    setIsCompleted(true);
                                    return 0;
                                }
                                return prev - 1;
                            });
                        } else {
                            setElapsedTime(prev => prev + 1);
                        }
                        
                        // Live Stats Update
                        setStats(prev => {
                            let mins;
                            if (currentDrill.duration) {
                                mins = (currentDrill.duration - elapsedTime + 1) / 60; // Time spent so far
                            } else {
                                mins = (elapsedTime + 1) / 60;
                            }
                            // Avoid div by zero
                            if (mins <= 0) mins = 0.01;
                            
                            const wpm = Math.round((inputText.length / 5) / mins);
                            return { ...prev, wpm: wpm > 0 ? wpm : 0 };
                        });
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [timerStatus, elapsedTime, inputText, currentDrill.duration]);

            const resetDrill = () => {
                setInputText("");
                setTimerStatus('idle');
                setElapsedTime(currentDrill.duration || 0);
                setStats({ wpm: 0, accuracy: 100, errors: 0, total: 0 });
                setIsCompleted(false);
                setIsShaking(false);
                if (inputRef.current) inputRef.current.focus();
            };

            const togglePause = () => {
                if (timerStatus === 'running') setTimerStatus('paused');
                else if (timerStatus === 'paused') setTimerStatus('running');
            };

            const handleKeyDown = (e) => {
                setPressedKeys(prev => new Set(prev).add(e.code));
                if (disableBackspace && e.key === 'Backspace') e.preventDefault();
            };

            const handleKeyUp = (e) => {
                setPressedKeys(prev => {
                    const next = new Set(prev);
                    next.delete(e.code);
                    return next;
                });
            };

            const handleChange = (e) => {
                const val = e.target.value;
                if (isCompleted || timerStatus === 'paused') return;

                if (timerStatus === 'idle' && val.length > 0) setTimerStatus('running');

                if (val.length > inputText.length) {
                    const typedChar = val.slice(-1);
                    const expectedChar = targetText[val.length - 1];
                    
                    if (strictMode && typedChar !== expectedChar) {
                        setIsShaking(true);
                        setTimeout(() => {
                            setIsShaking(false);
                            resetDrill();
                        }, 500);
                        return;
                    }

                    const newTotal = stats.total + 1;
                    let newErrors = stats.errors;
                    if (typedChar !== expectedChar) newErrors += 1;
                    
                    setStats(prev => ({
                        ...prev,
                        total: newTotal,
                        errors: newErrors,
                        accuracy: Math.round(((newTotal - newErrors) / newTotal) * 100)
                    }));
                }

                setInputText(val);
                
                // Completion Check (Only if not time-based or if text is fully typed)
                // For timed tests, we usually let time run out, but if they finish text, we can stop too.
                if (val.length === targetText.length) {
                    setTimerStatus('finished');
                    setIsCompleted(true);
                }
            };

            const nextDrill = () => {
                if (drillIndex < CURRICULUM[day].exercises.length - 1) {
                    setDrillIndex(drillIndex + 1);
                } else {
                    setDrillIndex(0);
                    alert("Day " + day + " Completed!");
                }
            };

            return (
                <div className={`min-h-screen bg-slate-900 text-slate-100 font-sans flex overflow-hidden ${isShaking ? 'animate-shake' : ''}`} onKeyDown={handleKeyDown} onKeyUp={handleKeyUp} tabIndex={0}>
                    
                    {/* SIDEBAR */}
                    <div className={`fixed inset-y-0 left-0 z-50 w-72 bg-slate-800 border-r border-slate-700 transform transition-transform duration-300 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 flex flex-col shadow-2xl`}>
                         <div className="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800 shrink-0">
                            <div className="font-bold text-lg flex items-center gap-2">Curriculum</div>
                            <button onClick={() => setSidebarOpen(false)} className="md:hidden text-slate-400"><Icons.X /></button>
                        </div>
                        <div className="p-4 bg-slate-800 border-b border-slate-700 shrink-0 space-y-3">
                             <div className="text-xs font-bold text-slate-500 uppercase tracking-wider">Exam Settings</div>
                             <label className="flex items-center gap-3 cursor-pointer p-2 rounded hover:bg-slate-700 transition-colors">
                                <div className={`w-8 h-4 rounded-full relative transition-colors ${disableBackspace ? 'bg-red-500' : 'bg-slate-600'}`}>
                                    <input type="checkbox" checked={disableBackspace} onChange={(e) => setDisableBackspace(e.target.checked)} className="opacity-0 w-full h-full absolute z-10 cursor-pointer" />
                                    <div className={`w-2 h-2 bg-white rounded-full absolute top-1 transition-transform ${disableBackspace ? 'left-5' : 'left-1'}`}></div>
                                </div>
                                <span className="text-sm flex items-center gap-2"><Icons.Lock /> No Backspace</span>
                             </label>
                             <label className="flex items-center gap-3 cursor-pointer p-2 rounded hover:bg-slate-700 transition-colors">
                                <div className={`w-8 h-4 rounded-full relative transition-colors ${strictMode ? 'bg-red-600' : 'bg-slate-600'}`}>
                                    <input type="checkbox" checked={strictMode} onChange={(e) => setStrictMode(e.target.checked)} className="opacity-0 w-full h-full absolute z-10 cursor-pointer" />
                                    <div className={`w-2 h-2 bg-white rounded-full absolute top-1 transition-transform ${strictMode ? 'left-5' : 'left-1'}`}></div>
                                </div>
                                <span className="text-sm flex items-center gap-2"><Icons.Skull /> Sudden Death</span>
                             </label>
                        </div>
                        <div className="p-2 grid grid-cols-4 gap-1 border-b border-slate-700 bg-slate-800 shrink-0">
                            {Object.keys(CURRICULUM).map(d => (
                                <button key={d} onClick={() => { setDay(parseInt(d)); setDrillIndex(0); }} className={`p-2 rounded text-xs font-bold transition-colors ${day === parseInt(d) ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-400 hover:bg-slate-600'}`}>
                                    Day {d}
                                </button>
                            ))}
                        </div>
                        <div className="flex-1 overflow-y-auto p-2 space-y-1 bg-slate-900/50 custom-scroll">
                            <div className="px-2 py-2 text-xs uppercase font-bold text-slate-500 tracking-wider sticky top-0 bg-slate-900/90 backdrop-blur z-10 border-b border-slate-800 mb-2">{CURRICULUM[day].title}</div>
                            {CURRICULUM[day].exercises.map((ex, idx) => (
                                <button key={ex.id} onClick={() => { setDrillIndex(idx); setSidebarOpen(false); }} className={`w-full text-left px-3 py-3 rounded-lg text-sm flex items-center gap-3 transition-all ${drillIndex === idx ? 'bg-blue-600/20 text-blue-200 border border-blue-500/50' : 'text-slate-400 hover:bg-slate-700 hover:text-white'}`}>
                                    <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${drillIndex === idx ? 'bg-blue-500 text-white' : 'bg-slate-700'}`}>{idx + 1}</div>
                                    <div className="flex-1 truncate"><div className="font-medium truncate">{ex.hint}</div></div>
                                    {idx < drillIndex && <span className="text-green-500"><Icons.Check /></span>}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* MAIN CONTENT */}
                    <div className="flex-1 flex flex-col h-screen overflow-hidden relative">
                        {/* TOP BAR */}
                        <div className="p-4 md:px-8 border-b border-slate-700 bg-slate-800 flex justify-between items-center shrink-0 z-20 shadow-lg">
                            <div className="flex items-center gap-4">
                                <button onClick={() => setSidebarOpen(true)} className="md:hidden p-2 bg-slate-700 rounded text-white"><Icons.Menu /></button>
                                <div>
                                    <h1 className="text-xl font-bold text-white leading-none">UP Police Typing</h1>
                                    <p className="text-xs text-slate-400 font-mono mt-1">
                                        {strictMode ? <span className="text-red-400 font-bold">STRICT MODE ACTIVE</span> : `Exercise ${drillIndex + 1}/${totalDrills}`}
                                    </p>
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <Timer status={timerStatus} time={elapsedTime} mode={currentDrill.duration ? 'down' : 'up'} />
                                <button onClick={togglePause} disabled={timerStatus === 'idle' || timerStatus === 'finished'} className={`p-3 rounded-full transition-all ${timerStatus === 'running' ? 'bg-yellow-500 text-black hover:bg-yellow-400' : 'bg-slate-700 text-slate-400'}`}>
                                    {timerStatus === 'paused' ? <Icons.Play /> : <Icons.Pause />}
                                </button>
                                <button onClick={resetDrill} className="p-3 bg-slate-700 rounded-full hover:bg-slate-600 text-white"><Icons.Refresh /></button>
                            </div>
                        </div>

                        {/* WORKSPACE - NEW 65/35 LAYOUT */}
                        <div className="flex-1 flex flex-col md:flex-row gap-0 overflow-hidden">
                            
                            {/* LEFT SIDE (65%): Target + Keyboard */}
                            <div className="flex-[6.5] flex flex-col bg-slate-900 border-r border-slate-800 relative">
                                
                                {/* 1. TARGET TEXT (Top) */}
                                <div className="flex-1 p-8 flex flex-col justify-center items-center relative overflow-hidden">
                                    <div className="absolute top-4 left-4 bg-slate-800 px-3 py-1 rounded-full text-xs font-mono text-slate-400 border border-slate-700 flex items-center gap-2">
                                         {strictMode && <span className="text-red-400 flex items-center gap-1 font-bold"><Icons.Skull /> SUDDEN DEATH</span>}
                                         {currentDrill.duration ? <span className="text-orange-400 flex items-center gap-1 font-bold">⏱️ TIMED TEST</span> : <span>Target Text</span>}
                                    </div>
                                    <div className="text-4xl md:text-5xl leading-relaxed font-hindi tracking-wide text-slate-300 text-center break-words max-w-3xl">
                                        {targetText.split('').map((char, i) => {
                                            let color = "text-slate-500";
                                            if (i < inputText.length) {
                                                color = inputText[i] === char ? "text-green-400" : "text-red-500 bg-red-900/20";
                                            } else if (i === inputText.length) {
                                                color = "text-blue-400 bg-blue-500/20 ring-2 ring-blue-500 rounded px-1";
                                            }
                                            return <span key={i} className={`${color} transition-colors duration-75`}>{char}</span>
                                        })}
                                    </div>
                                </div>

                                {/* 2. KEYBOARD (Bottom) */}
                                <div className="bg-slate-950 border-t border-slate-800 p-6 shadow-[0_-10px_40px_rgba(0,0,0,0.5)] z-10">
                                    <div className="flex justify-between items-center mb-4 px-4 text-xs font-bold uppercase text-slate-500 tracking-wider">
                                        <div className="flex items-center gap-2">
                                            <Icons.Keyboard /> Virtual Keyboard
                                        </div>
                                        <div className="flex items-center gap-2">
                                            Next Key: <span className="bg-yellow-500 text-black px-2 py-0.5 rounded font-mono font-bold text-sm">{nextChar === ' ' ? 'Space' : (nextChar ? Object.keys(INSCRIPT).find(key => INSCRIPT[key] === nextChar) || nextChar : 'End')}</span>
                                            <span className="text-slate-400 text-[10px] ml-2 border border-slate-700 px-2 py-0.5 rounded">Use: <span className="text-green-400 font-bold">{fingerHint}</span></span>
                                        </div>
                                    </div>
                                    <VirtualKeyboard nextChar={nextChar} pressedKeys={pressedKeys} />
                                </div>
                            </div>

                            {/* RIGHT SIDE (35%): Input Area */}
                            <div className="flex-[3.5] bg-slate-800/50 flex flex-col relative border-l border-slate-700 shadow-inner">
                                <div className="bg-slate-900 px-6 py-3 border-b border-slate-800 flex justify-between items-center">
                                    <span className="text-xs font-bold text-slate-400 uppercase tracking-wider">Your Input</span>
                                    <div className="flex gap-3 text-xs font-mono">
                                        <span className="text-green-400">WPM: {stats.wpm}</span>
                                        <span className="text-blue-400">ACC: {stats.accuracy}%</span>
                                    </div>
                                </div>
                                <textarea
                                    ref={inputRef}
                                    value={inputText}
                                    onChange={handleChange}
                                    disabled={isCompleted || timerStatus === 'paused'}
                                    spellCheck={false}
                                    className={`w-full h-full bg-transparent p-6 text-2xl font-hindi text-white outline-none resize-none transition-all placeholder:text-slate-600 ${strictMode ? 'focus:bg-red-900/10' : 'focus:bg-slate-800'} ${timerStatus === 'paused' ? 'blur-sm' : ''}`}
                                    placeholder={timerStatus === 'idle' ? "Click here & start typing..." : ""}
                                />
                                
                                {/* PAUSE OVERLAY */}
                                {timerStatus === 'paused' && (
                                    <div className="absolute inset-0 flex flex-col items-center justify-center z-10 bg-slate-900/60 backdrop-blur-sm">
                                        <div className="bg-yellow-500 text-black p-4 rounded-full mb-2 shadow-lg"><Icons.Pause /></div>
                                        <div className="text-2xl font-bold text-white tracking-widest">PAUSED</div>
                                        <button onClick={togglePause} className="mt-6 px-8 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold shadow-lg transform transition hover:scale-105">Resume</button>
                                    </div>
                                )}

                                {/* COMPLETION OVERLAY */}
                                {isCompleted && (
                                    <div className="absolute inset-0 z-20 bg-slate-900/95 backdrop-blur-md flex flex-col items-center justify-center animate-in fade-in zoom-in duration-300">
                                        <div className="text-yellow-400 mb-2 scale-150"><Icons.Check /></div>
                                        <h2 className="text-4xl font-bold text-white mb-2">Great Job!</h2>
                                        <div className="text-slate-400 mb-8 text-lg flex gap-8">
                                            <div className="text-center">
                                                <div className="text-3xl font-bold text-white">{stats.wpm}</div>
                                                <div className="text-xs uppercase tracking-wider">WPM</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-3xl font-bold text-white">{stats.accuracy}%</div>
                                                <div className="text-xs uppercase tracking-wider">Accuracy</div>
                                            </div>
                                        </div>
                                        <div className="flex gap-4">
                                            <button onClick={resetDrill} className="px-6 py-3 rounded-xl bg-slate-800 hover:bg-slate-700 text-white font-bold flex items-center gap-2 border border-slate-700"><Icons.Refresh /> Retry</button>
                                            <button onClick={nextDrill} className="px-8 py-3 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold flex items-center gap-2 shadow-lg transform transition hover:scale-105">Next Level <Icons.Play /></button>
                                        </div>
                                    </div>
                                )}
                            </div>

                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
